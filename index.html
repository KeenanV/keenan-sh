<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keenan Van Deusen</title>

  <!-- Standard favicon -->
  <link rel="icon" type="image/x-icon" href="favicon/favicon.ico">

  <!-- Alternative in PNG format -->
  <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">

  <!-- Apple Touch Icon (for iOS devices) -->
  <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">

  <!-- Android Chrome Icon -->
  <link rel="manifest" href="favicon/manifest.json">
  <meta name="theme-color" content="#000000">  <!-- This sets the color of the browser UI -->
  <link rel="icon" type="image/png" sizes="192x192" href="favicon/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="favicon/android-chrome-512x512.png">

  <style>
      body,
      html {
          height: 100%;
          margin: 0;
          padding: 0;
          font-family: Arial, sans-serif;
          overflow-x: hidden;
      }

      body {
          background-color: #000000;
          background-image: url('background.jpg');
          /* Replace with your image */
          background-size: cover;
          background-position: center;
          background-repeat: no-repeat;
          background-attachment: fixed;
      }

      body.no-scroll {
          overflow: hidden;
          position: fixed;
          width: 100%;
          height: 100%;
      }

      .container {
          min-height: 100%;
          display: flex;
          justify-content: center;
          align-items: center;
          padding: 20px;
          box-sizing: border-box;
      }

      .content {
          background-color: #202020;
          border-radius: 20px;
          padding: 0px 30px 20px 30px;
          text-align: center;
          max-width: 400px;
          width: 100%;
          box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
          max-height: 90vh;
          overflow-y: auto;
      }

      .profile-pic {
          /*position: absolute;*/
          /*z-index: 0;*/
          /*top: 13%;*/
          background-color: #202020;
          transform: translateY(-50px);
          width: 285px;
          height: 285px;
          border-radius: 50%;
          margin-top: -1px;
          margin-bottom: -300px;
          box-shadow: none;
          border: none;
          /*box-shadow: 0 5px 15px rgba(134, 7, 206, 0.27);
          border: 3px solid #1e1e1e;*/
          object-fit: scale-down;
          /*overflow: hidden;*/
      }

      .name {
          position: relative;
          z-index: 1;
          padding-top: 215px;
          color: #fff6ea;
          font-size: 32px;
          font-weight: bold;
          margin-bottom: 8px;
      }

      .title {
          position: relative;
          z-index: 1;
          color: #9f9f9f;
          font-size: 20px;
          margin-bottom: 20px;
      }

      .link-button {
          position: relative;
          z-index: 1;
          display: flex;
          align-items: center;
          background-color: #111111;
          color: #fff;
          padding: 15px;
          margin: 20px 0;
          border-radius: 10px;
          text-decoration: none;
          font-size: 18px;
          transition: all 0.1s ease;
          box-shadow: 5px 8px #8607ce;
          border: none;
          cursor: pointer;
      }

      .link-button:hover {
          transform: translateY(-2px);
          box-shadow: 7px 10px #8607ce;
          background-color: #222222;
      }

      .link-button:active {
          transform: translateY(3px);
          box-shadow: 0 0 #8607ce;
      }

      .link-button i {
          margin-right: 15px;
          font-size: 20px;
          width: 24px;
          text-align: center;
      }

      .social-icons {
          position: relative;
          z-index: 1;
          margin-top: 30px;
      }

      .social-icons a {
          color: #9f9f9f;
          font-size: 24px;
          margin: 0 10px;
          text-decoration: none;
          transition: all 0.2s ease;
      }

      .social-icons a:hover {
          transform: scale(1.2);
          color: #cdcdcd;
      }

      .dialog {
          display: none;
          position: fixed;
          z-index: 2000;
          left: 0;
          top: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.5);
      }

      .dialog-content {
          background-color: #f5f3e5;
          margin: 15% auto;
          padding: 20px;
          border: 1px solid #888;
          width: 95%;
          max-width: 500px;
          border-radius: 10px;
          box-sizing: border-box;
      }

      .dialog-content h2 {
          color: #333;
          margin-bottom: 20px;
          margin-top: 5px;
          text-align: center;
          font-size: 28px;
          font-weight: 900;
      }

      .dialog-content form {
          display: flex;
          flex-direction: column;
      }

      .dialog-content input,
      .dialog-content textarea {
          width: 100%;
          padding: 10px;
          margin-bottom: 15px;
          border: none;
          border-radius: 5px;
          box-sizing: border-box;
          transition: all 0.1s ease;
          background-color: #111111;
          color: #fff;
          box-shadow: 3px 5px #8607ce;
      }

      /* Style for the placeholder text */
      .dialog-content input::placeholder,
      .dialog-content textarea::placeholder {
          color: #888; /* Light grey color for placeholder text */
      }

      @keyframes clickEffect {
          0% {
              transform: translateY(-2px);
          }
          50% {
              transform: translateY(3px);
              box-shadow: 0 0 #8607ce;
          }
          100% {
              transform: translateY(-2px);
              box-shadow: 5px 8px #0ba106;
          }
      }

      .dialog-content input:hover,
      .dialog-content textarea:hover {
          transform: translateY(-2px);
          outline: none;
          border: none;
          box-shadow: 5px 8px #8607ce;
      }

      /* Active and Focus styles combined */
      .dialog-content input:active,
      .dialog-content textarea:active,
      .dialog-content input:focus,
      .dialog-content textarea:focus {
          outline: none;
          animation: clickEffect 0.3s ease forwards;
      }

      /* Ensure hover doesn't interfere with focus state */
      .dialog-content input:hover:focus,
      .dialog-content textarea:hover:focus {
          transform: translateY(-2px);
          box-shadow: 5px 8px #0ba106;
      }

      .dialog-content textarea {
          height: 200px;
      }

      .dialog-buttons {
          text-align: center;
          margin-top: 15px;
          margin-bottom: 10px;
      }

      .dialog-buttons button {
          background-color: #111111;
          color: #fff;
          padding: 10px 20px;
          margin: 0 20px;
          border-radius: 5px;
          text-decoration: none;
          font-size: 18px;
          font-weight: bold;
          transition: all 0.1s ease;
          box-shadow: 3px 5px #8607ce;
          border: none;
          cursor: pointer;
      }

      .dialog-buttons button:hover {
          transform: translateY(-2px);
          box-shadow: 5px 8px #8607ce;
          background-color: #222222;
      }

      .dialog-buttons button:active {
          transform: translateY(3px);
          box-shadow: 0 0 #8607ce;
      }

      .dialog-buttons button[type="submit"] {
          color: rgb(11, 147, 11);
      }

      .dialog-buttons button[type="button"] {
          color: rgb(219, 0, 0);
      }

      .projects-container {
          display: flex;
          align-items: flex-start;
          position: absolute;
          top: 0;
          left: 0;
          width: 90%;
          height: 100%;
          overflow-y: auto;
          padding: 40px 20px;
          /*display: flex;*/
          /*justify-content: center;*/
          /*align-items: center;*/
          z-index: 1000;
          transition: background-color 0.3s ease;
      }

      .projects-grid {
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          grid-row-gap: 0;
          gap: 20px;
          width: 80%;
          height: 60%;
          max-width: none;
          margin: 0 auto;
          position: relative;
          z-index: 1001;
          box-sizing: border-box;
      }

      .project-square {
          position: relative;
          aspect-ratio: 1 / 1;
          margin: 0;
          width: 100%;
          opacity: 0;
          visibility: hidden;
          box-sizing: border-box;
      }

      .project-square-inner {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          transform-style: preserve-3d;
          transition: transform 0.6s ease, box-shadow 0.1s ease;
          border-radius: 40px;
          background-color: #111111;
          color: #fff;
          cursor: pointer;
          box-shadow: 5px 8px #8607ce;
          box-sizing: border-box;
          --after-border-radius: 40px;
      }

      .project-square.visible {
          opacity: 1;
          visibility: visible;
      }

      .project-square.fall-in {
          animation: fallIn 0.8s ease-in-out forwards;
      }

      .project-square.fall-out {
          animation: fallOut 0.5s ease-in forwards;
      }

      .project-square-inner::after {
          content: '';
          position: absolute;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: rgba(0, 0, 0, 0.7);
          border-radius: var(--after-border-radius);
          box-shadow: 5px 8px #2e0142;
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.3s ease, all 0.1s ease, transform 0.1s ease;
          box-sizing: border-box;
      }

      .project-square-inner.darkened::after {
          opacity: 1;
      }

      .project-square-inner.darkened:hover::after {
          box-shadow: 7px 13px #2e0142;
      }

      .project-square-inner.darkened:active::after {
          transform: translateY(5px);
          box-shadow: 0 0 #2e0142;
      }

      .project-square-inner:hover {
          transform: translateY(-5px) rotateY(10deg);
          box-shadow: 7px 13px #8607ce;
      }

      .project-square-inner:active {
          transform: translateY(5px);
          box-shadow: 0 0 #8607ce;
      }

      .project-square.flipped {
          z-index: 1003;
      }

      .project-square.flipped .project-square-inner {
          box-shadow: none;
          min-height: 40vh;
          max-height: 90vh;
          height: 40vh;
          /*overflow-y: auto;*/
          /* Center the content */
          margin: 0 auto;
      }

      .project-square.flipped .project-square-inner:hover {
          /* Prevent hover effects when flipped */
          transform: none;
          box-shadow: none;
      }

      .project-square.flipped::after .project-square-inner::after {
          opacity: 0;
      }

      .project-square-inner.dragging {
          transition: none;
          cursor: grabbing;
          touch-action: none;
      }

      .project-square-inner.flipped {
          cursor: grab;
          touch-action: none;
      }

      .project-square-inner.flipped:active {
          cursor: grabbing;
      }

      .project-square-inner.dismissing {
          transition: all 0.3s ease-out;
      }

      .darkened {
          background-color: rgba(0, 0, 0, 0.8);
      }

      .project-square-front, .project-square-back {
          position: absolute;
          width: 100%;
          height: 100%;
          backface-visibility: hidden;
          display: flex;
          flex-direction: column; /* Stack items vertically */
          justify-content: center;
          align-items: center;
          font-weight: normal;
          margin: 0;
          padding: 20px; /* Add padding for content */
          box-sizing: border-box; /* Include padding in width and height */
      }

      .project-square-front {
          font-weight: bold;
          font-size: 1.5em;
          text-align: center;
      }

      .project-square-back {
          width: 100%;
          height: 100%;
          position: absolute;
          top: 0;
          left: 0;
          border-radius: 20px;
          transform: rotateY(180deg);
          background-color: #1b1b1b;
          text-align: center;
          justify-content: space-between; /* Align items to the top */
          transition: transform 0.6s ease;
      }

      .project-square-back h2 {
          /* Space between header and description */
          margin: 0 0 10px;
          font-size: 1.5em;
          font-weight: bold;
      }

      .project-square-back h3 {
          margin-top: 0;
          margin-bottom: 10px;
      }

      .project-square-back p {
          flex-grow: 1;
          overflow-y: auto;
          margin: 0 0 15px;
          font-size: 0.65em;
          line-height: 1.5;
      }

      .slide-out {
          animation: slideOut 0.5s forwards;
      }

      .slide-in {
          animation: slideIn 0.5s forwards;
      }

      .github-button {
          display: inline-block;
          background-color: #111111;
          color: #fff;
          padding: 7px 5px;
          border-radius: 5px;
          text-decoration: none;
          font-size: 16px;
          font-weight: bold;
          transition: all 0.1s ease;
          box-shadow: 3px 5px #8607ce;
          border: none;
          cursor: pointer;
          align-self: center;
          width: 80%;
          margin-top: auto;
      }

      .github-button:hover {
          transform: translateY(-2px);
          box-shadow: 5px 7px #8607ce;
          background-color: #222222;
      }

      .github-button:active {
          transform: translateY(3px);
          box-shadow: 0 0 #8607ce;
      }

      .github-button i {
          margin-right: 5px;
          font-size: 22px;
          width: 24px;
          text-align: center;
      }

      .close-button {
          position: absolute;
          top: 10px;
          right: 10px;
          width: 8%;
          aspect-ratio: 1 / 1;
          background-color: #111111;
          color: #333333;
          border: none;
          border-radius: 50%;
          cursor: pointer;
          box-shadow: 2px 3px #8607ce;
          padding: 0;
          overflow: hidden;
          transition: all 0.1s ease;
      }

      .close-button i {
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          font-size: 26px;
          font-weight: bolder;
      }

      .close-button:hover {
          color: #4a4a4a;
          transform: translateY(-2px);
          box-shadow: 3px 4px #8607ce;
      }

      .close-button:active {
          transform: translateY(3px);
          box-shadow: 0 0 #8607ce;
      }

      .project-square-back h3 {
          margin: 20px 10px 10px;
      }

      .project-square-back p {
          flex-grow: 1;
          overflow-y: auto;
          margin-bottom: 15px;
      }

      @keyframes slideOut {
          0% {
              transform: translateX(0);
              opacity: 1;
          }
          100% {
              transform: translateX(-100%);
              opacity: 0;
          }
      }

      @keyframes slideIn {
          0% {
              transform: translateX(100%);
              opacity: 0;
          }
          100% {
              transform: translateX(0);
              opacity: 1;
          }
      }

      @keyframes fallIn {
          0% {
              transform: translateY(-350%);
              opacity: 0.5;
          }
          60% {
              transform: translateY(15%);
              opacity: 1;
          }
          80% {
              transform: translateY(-7%);
          }
          100% {
              transform: translateY(0);
          }
      }

      @keyframes fallOut {
          0% {
              transform: translateY(0);
              opacity: 1;
          }
          100% {
              transform: translateY(600%);
              opacity: 0.5;
          }
      }

      @media screen and (max-height: 500px) {
          .container {
              align-items: flex-start;
          }

          .content {
              margin-top: 20px;
              margin-bottom: 20px;
          }

          .profile-pic {
              width: 80px;
              height: 80px;
          }

          .name {
              font-size: 20px;
          }

          .title {
              font-size: 14px;
          }

          .link-button {
              padding: 10px;
              font-size: 16px;
          }
      }
  </style>
  <script src="https://kit.fontawesome.com/92164d8d93.js"
          crossorigin="anonymous"></script>
</head>

<body>
<div class="container">
  <div class="content">
    <img src="profile.png" alt="Keenan Van Deusen" class="profile-pic">
    <div class="name">Keenan Van Deusen</div>
    <div class="title">Security Engineer</div>
    <a href="#" class="link-button" id="projectsButton"
       data-action="projects"><i class="fas fa-code-branch"></i>Projects</a>
    <a href="https://www.linkedin.com/in/keenanvandeusen" class="link-button"><i
        class="fas fa-user"></i>About
      Me</a>
    <a href="#" class="link-button" data-action="contact"><i
        class="fas fa-envelope"></i>Get In Touch</a>
    <div class="social-icons">
      <a href="https://x.com/keenanvandeusen"><i
          class="fab fa-x-twitter"></i></a>
      <a href="https://signal.me/#eu/7dIHP7z5uEaknjV_JLLDN3F-TfsQTmj14SW2NIpcVGaJB8xZHgFLfpAIrrj0Illl"><i
          class="fab fa-signal-messenger"></i></a>
      <a href="https://www.linkedin.com/in/keenanvandeusen"><i
          class="fab fa-linkedin"></i></a>
      <a href="https://www.github.com/KeenanV"><i
          class="fab fa-github"></i></a>
    </div>
  </div>
</div>
<div id="contactDialog" class="dialog">
  <div class="dialog-content">
    <h2>Get in touch</h2>
    <form id="contactForm">
      <label for="name"></label><input type="text" id="name"
                                       placeholder="name" required>
      <label for="email"></label><input type="email" id="email"
                                        placeholder="email" required>
      <label for="message"></label><textarea id="message"
                                             placeholder="message"
                                             required></textarea>
      <div class="dialog-buttons">
        <button type="button" id="cancelButton">cancel</button>
        <button type="submit">send</button>
      </div>
    </form>
  </div>
</div>
<div class="projects-container" style="display: none;">
  <div class="overlay" style="display: none;"></div>
  <div class="projects-grid">
    <!-- Project squares will be added here dynamically -->
  </div>
</div>
<script>
  const projectsButton = document.getElementById('projectsButton');
  const getInTouchButton = document.querySelector(
      '.link-button[data-action="contact"]');
  const contactDialog = document.getElementById('contactDialog');
  const cancelButton = document.getElementById('cancelButton');
  let cancelSize = 20;
  const contactForm = document.getElementById('contactForm');
  const mainContent = document.querySelector('.content');
  const projectsContainer = document.querySelector('.projects-container');
  const projectsGrid = document.querySelector('.projects-grid');
  const projectsData = {
    "Project 1": {
      name: "Bash Bunny Persistent Reverse Shell",
      description: "Wrote attacks for Windows and macOS that used NetCat to launch persistent reverse shells using a Bash Bunny by Hak5.",
      link: "https://github.com/KeenanV/bashbunny-payloads/tree/master/payloads/library/remote_access"
    },
    "Project 2": {
      name: "LinkedIn Scraper + Graph Database",
      description: "Scraped data from LinkedIn using Selenium in Python to collect 1st and 2nd degree connections plus their work history and compile it all into a neo4j graph database",
      link: "https://www.github.com/KeenanV/connections"
    },
    "Project 3": {
      name: "AWS Secure Data Access + Management",
      description: "Built a system to securely manage data access and management for AWS resources. Wrote and implemented Double Ratchet following the Signal Protocol's recommendations, for communication between servers through which trust was distributed.",
      link: "https://github.com/KeenanV/aws-secure-data-access"
    },
    "Project 4": {
      name: "Secure Messenger",
      description: "Developed a secure messenger with a client-server relationship but client-client communications. Used SRP, ECDH, and AES-GCM for secure login and communications while giving the server minimum knowledge of the users.",
      link: "https://github.com/KeenanV/secure-messenger"
    },
    "Project 5": {
      name: "THIS ONE!",
      description: "Yes, I built this website from scratch using HTML, CSS, and JavaScript and deployed it on Google Cloud Platform. I had assistance from Anthropic's Claude Sonnet 3.5 and OpenAI's o1-preview, especially in building the foundation and debugging because I had very little web development experience starting out.",
      link: "https://github.com/KeenanV/keenan-sh"
    },
    "Project 6": {
      name: "Autonomous Drone Swarm: OFFSET",
      description: "While working at Raytheon BBN, I helped build an autonomous drone swarm that is manned by one person. I implemented livestreaming capabilities from the drone cameras to the desktop software we'd written. Then, we demoed our final version for the US, British, and Dutch armies at Fort Benning.",
      link: "https://www.darpa.mil/program/offensive-swarm-enabled-tactics"
    },
    "Project 7": {
      name: "ASTARTE",
      description: "While working at Raytheon BBN, my team was building a system that used seven microservices to constantly scan, reroute, and find dangers in the airspace autonomously. I helped push our test coverage toward 80% for the microservice we were working on.",
      link: "https://www.darpa.mil/news-events/2020-04-07"
    },
    "Project 8": {
      name: "MACE",
      description: "While working at Raytheon BBN, my team and I developed and built a system using Raspberry Pis to enable cadets at military academies to train their mission planning, tactics, and drone operation skills. I helped implement new target types, raised security concerns, and worked with Air Force cadets in Colorado to evaluate and better the system.",
      link: "https://github.com/raytheonbbn/mace"
    },
    "Project 9": {
      name: "iOS App 'One Step'",
      description: "IN PROGRESS. Working on an app that aims to take the overwhelm out of looking at a big todo list. The app will display only one task from a list (and will randomly select one if the user would like), until that task is done. There will be streaks, points, and sharing abilities to keep users motivated. FYI, this project is not public on GitHub yet because I haven't released the app",
      link: ""
    },
  }

  console.log("Get in Touch button:", getInTouchButton);
  console.log("Contact dialog:", contactDialog);

  function updatePseudoElement(element, properties) {
    Object.keys(properties).forEach(property => {
      element.style.setProperty(`--after-${property}`, properties[property]);
    });
  }

  function resizeGrid() {
    // Adjust projects-grid styles
    const projectsGrid = document.querySelector('.projects-grid');
    const projectsContainer = document.querySelector('.projects-container');
    const allSquares = document.querySelectorAll('.project-square');
    const windowRatio = window.innerHeight / window.innerWidth;
    let squareFrontTextSize = (window.innerWidth * window.innerHeight) / 10000;
    console.log(`Window Ratio: ${windowRatio}`);
    console.log(`Squares: ${allSquares.length}`);

    if (windowRatio < 1) {
      // Wide screens
      projectsContainer.style.width = '100%';
      projectsGrid.style.gridTemplateColumns = 'repeat(4, 1fr)';
      projectsGrid.style.gap = '40px';
      projectsGrid.style.maxWidth = '80%';
      cancelSize = 20;

      allSquares.forEach(square => {
        const front = square.querySelector('.project-square-front');
        const inner = square.querySelector('.project-square-inner');
        const borderRadius = window.innerWidth / 30 + 'px';
        inner.style.borderRadius = borderRadius;
        updatePseudoElement(inner, {
          'border-radius': borderRadius
        });
        front.style.fontSize = `${squareFrontTextSize / 4}px`;
        console.log(`Text Size: ${squareFrontTextSize}`);
      });
      console.log(`Wide screen: ${windowRatio}`);
    } else if (1 <= windowRatio && windowRatio < 1.5) {
      // Medium screens
      projectsContainer.style.width = '90%';
      projectsGrid.style.gridTemplateColumns = 'repeat(3, 1fr)';
      projectsGrid.style.gap = '30px';
      projectsGrid.style.maxWidth = '90%';
      cancelSize = 17;

      allSquares.forEach(square => {
        const front = square.querySelector('.project-square-front');
        const inner = square.querySelector('.project-square-inner');
        const borderRadius = window.innerWidth / 30 + 'px';
        inner.style.borderRadius = borderRadius;
        updatePseudoElement(inner, {
          'border-radius': borderRadius
        });
        front.style.fontSize = `${squareFrontTextSize / 3}px`;
        console.log(`Text Size: ${squareFrontTextSize}`);
        console.log(`Border Radius: ${window.innerWidth / 30}`);
      });
      console.log(`Medium screen: ${windowRatio}`);
    } else if (1.5 <= windowRatio && windowRatio < 2.25) {
      // Narrow screens
      projectsContainer.style.width = '90%';
      projectsGrid.style.gridTemplateColumns = 'repeat(2, 1fr)';
      projectsGrid.style.gap = '20px';
      projectsGrid.style.maxWidth = '80%';
      cancelSize = 13;

      allSquares.forEach(square => {
        const front = square.querySelector('.project-square-front');
        const inner = square.querySelector('.project-square-inner');
        const borderRadius = window.innerWidth / 20 + 'px';
        inner.style.borderRadius = borderRadius;
        updatePseudoElement(inner, {
          'border-radius': borderRadius
        });
        front.style.fontSize = `${squareFrontTextSize / 2}px`;
        console.log(`Text Size: ${squareFrontTextSize}`);
      });
      console.log(`Narrow screen: ${windowRatio}`);
    } else {
      // Extra narrow screens
      projectsContainer.style.width = '80%';
      projectsGrid.style.gridTemplateColumns = 'repeat(1, 1fr)';
      projectsGrid.style.gap = '15px';
      projectsGrid.style.maxWidth = '100%';
      cancelSize = 11;

      allSquares.forEach(square => {
        const front = square.querySelector('.project-square-front');
        const inner = square.querySelector('.project-square-inner');
        const borderRadius = window.innerWidth / 20 + 'px';
        inner.style.borderRadius = borderRadius;
        updatePseudoElement(inner, {
          'border-radius': borderRadius
        });
        front.style.fontSize = `${squareFrontTextSize}px`;
        console.log(`Text Size: ${squareFrontTextSize}`);
      });
      console.log(`Extra narrow screen: ${windowRatio}`);
    }
  }

  function switchToProjects() {
    mainContent.classList.remove('slide-in');
    mainContent.classList.add('slide-out');
    setTimeout(() => {
      mainContent.style.display = 'none';
      projectsContainer.style.display = 'flex';
      loadProjects();
      resizeGrid();
    }, 500);
  }

  function switchToMain() {
    const squares = document.querySelectorAll('.project-square');
    squares.forEach((square, index) => {
      setTimeout(() => {
        square.classList.add('fall-out');
        square.classList.remove('fall-in');
      }, (7 - index) * 100);
    });

    setTimeout(() => {
      projectsContainer.style.display = 'none';
      mainContent.style.display = 'block';
      mainContent.classList.remove('slide-out');
      mainContent.classList.add('slide-in');
      resetMainPage();
    }, squares.length * 100 + 500);
  }

  function resetProjectsGrid() {
    const squares = document.querySelectorAll('.project-square');
    squares.forEach(square => {
      square.classList.remove('fall-out');
      square.style.visibility = 'hidden';
      square.style.opacity = '0';
    });
  }

  function resetMainPage() {
    // Reset any state that might have been changed
    document.body.style.overflow = '';
    contactDialog.style.display = 'none';
    document.body.style.backgroundColor = '';
    resetProjectsGrid();
  }

  document.addEventListener('click', function (e) {
    if (e.target.closest('.link-button')) {
      const action = e.target.closest('.link-button').dataset.action;

      if (action === 'contact') {
        console.log("Get in Touch button clicked");
        contactDialog.style.display = 'block';
        document.body.style.backgroundColor = '#000000';
      } else if (action === 'projects') {
        console.log("Projects button clicked");
        switchToProjects();
      }
    }
  });

  // Add a click event listener to close the dialog
  document.addEventListener('click', function (e) {
    if (e.target === contactDialog) {
      contactDialog.style.display = 'none';
      document.body.style.backgroundColor = '#000000';
    }
  });

  cancelButton.addEventListener('click', function () {
    contactDialog.style.display = 'none';
  });

  contactForm.addEventListener('submit', function (e) {
    e.preventDefault();
    const formData = {
      name: document.getElementById('name').value,
      email: document.getElementById('email').value,
      message: document.getElementById('message').value
    };

    fetch(
        'https://us-west2-personal-website-432623.cloudfunctions.net/sendEmail',
        {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData),
        })
    .then(response => response.text())
    .then(data => {
      alert('Message sent!');
      contactDialog.style.display = 'none';
      contactForm.reset();
    })
    .catch((error) => {
      console.error('Error:', error);
      alert('An error occurred. Please try again.');
    });
  });

  window.addEventListener('click', function (e) {
    if (e.target === contactDialog) {
      contactDialog.style.display = 'none';
    }
  });

  function getButtonDetails(link) {
    if (link.includes('github.com')) {
      return {text: 'View on GitHub', icon: 'fab fa-github'};
    } else if (link.includes('darpa.mil')) {
      return {text: 'View on DARPA', icon: 'fas fa-shield-halved'};
    } else {
      return {text: 'Link Coming Soon', icon: 'fas fa-hammer'};
    }
  }

  function loadProjects() {
    projectsGrid.innerHTML = '';
    Object.values(projectsData).forEach((project, index) => {
      const buttonDetails = getButtonDetails(project.link);
      const projectSquare = document.createElement('div');
      projectSquare.className = 'project-square';
      projectSquare.innerHTML = `
            <div class="project-square-inner">
                <div class="project-square-front">${project.name}</div>
                <div class="project-square-back">
                    <button class="close-button">
                        <i class="fas fa-circle-xmark"></i>
                    </button>
                    <h3>${project.name}</h3>
                    <p>${project.description}</p>
                    <a href="${project.link}" ${((project.link) ? '' : 'onclick="return false;"')} class="github-button" target="_blank">
                        <i class="${buttonDetails.icon}"></i>${buttonDetails.text}
                    </a>
                </div>
            </div>
        `;
      projectsGrid.appendChild(projectSquare);

      // Add event listener for the close button
      const closeButton = projectSquare.querySelector('.close-button');
      closeButton.addEventListener('click', (e) => {
        e.stopPropagation(); // Prevent event from bubbling up
        if (currentlyFlippedSquare) {
          unflipSquare(currentlyFlippedSquare);
          resetProjectGrid();
          currentlyFlippedSquare = null;
        }
      });

      // Trigger the fall-in animation after a delay
      setTimeout(() => {
        projectSquare.classList.add('visible', 'fall-in');
      }, index * 100);
    });
  }

  // Add this function to calculate and apply the transform
  function flipSquare(square) {
    const innerSquare = square.querySelector('.project-square-inner');
    const githubButton = square.querySelector('.github-button');
    const githubIcon = square.querySelector('.github-button i');
    const closeButton = square.querySelector('.close-button');
    const closeIcon = square.querySelector('.close-button i');
    const backSquareHeading = square.querySelector('.project-square-back h3');
    const backSquareBody = square.querySelector('.project-square-back p');
    const rect = innerSquare.getBoundingClientRect();

    // Get viewport dimensions
    const viewportWidth = window.innerWidth;
    const viewportHeight = window.innerHeight;
    console.log(`Screen size: ${viewportWidth} x ${viewportHeight}`);

    let squareHeight = viewportHeight * 0.4;
    let squareWidth = viewportWidth * 0.4;
    let githubTextSize = Math.max(viewportWidth, viewportHeight) / 90;
    let githubIconSize = githubTextSize * 1.4;
    let githubIconWidth = githubIconSize + 2;
    let closeButtonSize = (Math.max(squareWidth, squareHeight) / Math.min(squareWidth, squareHeight)) * cancelSize;
    console.log(`Close button size: ${closeButtonSize}`);
    let backSquareBodyTextSize = githubTextSize;
    let backSquareHeadingTextSize = backSquareBodyTextSize * 2;

    if (viewportHeight < viewportWidth) {
      squareHeight = viewportHeight * 0.4;
      squareWidth = viewportWidth * 0.3;
    } else if (viewportHeight > viewportWidth) {
      squareHeight = viewportHeight * 0.45;
      squareWidth = viewportWidth * 0.45;
    }

    // Desired maximum dimensions
    const maxWidth = viewportWidth * 0.9; // 90% of viewport width
    const maxHeight = viewportHeight * 0.9; // 90% of viewport height

    // Calculate scale factors
    const scaleX = maxWidth / squareWidth;
    const scaleY = maxHeight / squareHeight;
    const scale = Math.min(scaleX, scaleY, 2); // Limit maximum scale to 2

    // Calculate translation to center the square
    const squareCenterX = rect.left + squareWidth / 2;
    const squareCenterY = rect.top + squareHeight / 2;
    const viewportCenterX = viewportWidth / 2;
    const viewportCenterY = viewportHeight / 2;
    const translateX = viewportCenterX - squareCenterX;
    const translateY = viewportCenterY - squareCenterY;

    innerSquare.style.height = `${squareHeight}px`;
    innerSquare.style.width = `${squareWidth}px`;
    backSquareHeading.style.fontSize = `${backSquareHeadingTextSize}px`;
    backSquareBody.style.fontSize = `${backSquareBodyTextSize}px`;
    githubButton.style.fontSize = `${githubTextSize}px`;
    githubIcon.style.fontSize = `${githubIconSize}px`;
    githubIcon.style.width = `${githubIconWidth}px`;
    closeButton.style.width = `${closeButtonSize}px`;
    closeIcon.style.fontSize = `${closeButtonSize * 0.72}px`;
    // Apply transformations
    innerSquare.style.transform = `
        translate(${translateX}px, ${translateY}px)
        scale(${scale})
        rotateY(180deg)
    `;

    closeButton.style.display = 'flex';

    innerSquare.classList.add('flipped');
    square.classList.add('flipped');
  }

  // Function to reset the transform
  function unflipSquare(square) {
    const innerSquare = square.querySelector('.project-square-inner');
    innerSquare.style.transform = '';
    innerSquare.style.height = '100%';
    innerSquare.style.width = '100%';
    innerSquare.classList.remove('flipped');
    square.classList.remove('flipped');

    const closeButton = square.querySelector('.close-button');
    closeButton.style.display = 'none';
  }

  let isDragging = false;
  let startX, startY;
  let originalTransform = '';
  let currentScale = 1;
  let scrollY = 0;

  function handleDragStart(e) {
    if (!currentlyFlippedSquare) {
      return;
    }

    isDragging = true;
    const innerSquare = currentlyFlippedSquare.querySelector(
        '.project-square-inner');
    innerSquare.classList.add('dragging');

    if (e.type === 'mousedown') {
      startX = e.clientX;
      startY = e.clientY;
    } else if (e.type === 'touchstart') {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    }

    originalTransform = innerSquare.style.transform;
    currentScale = parseScale(originalTransform);

    // Prevent scrolling
    scrollY = window.scrollY;
    document.body.classList.add('no-scroll');
    document.body.style.top = `-${scrollY}px`;
  }

  function parseScale(transform) {
    const match = transform.match(/scale\(([^)]+)\)/);
    return match ? parseFloat(match[1]) : 1;
  }

  function handleDrag(e) {
    if (!isDragging) {
      return;
    }

    let currentX, currentY;
    if (e.type === 'mousemove') {
      currentX = e.clientX;
      currentY = e.clientY;
    } else if (e.type === 'touchmove') {
      currentX = e.touches[0].clientX;
      currentY = e.touches[0].clientY;
      e.preventDefault(); // Prevent scrolling on touch devices
    }

    const deltaX = (currentX - startX) / currentScale;
    const deltaY = (currentY - startY) / currentScale;

    const innerSquare = currentlyFlippedSquare.querySelector(
        '.project-square-inner');
    // Invert the X-axis movement to account for the flipped state
    innerSquare.style.transform = `${originalTransform} translate(${-deltaX}px, ${deltaY}px)`;
  }

  function handleDragEnd(e) {
    if (!isDragging) {
      return;
    }

    isDragging = false;
    const innerSquare = currentlyFlippedSquare.querySelector(
        '.project-square-inner');
    innerSquare.classList.remove('dragging');

    let endX, endY;
    if (e.type === 'mouseup') {
      endX = e.clientX;
      endY = e.clientY;
    } else if (e.type === 'touchend') {
      endX = e.changedTouches[0].clientX;
      endY = e.changedTouches[0].clientY;
    }

    const deltaX = (endX - startX) / currentScale;
    const deltaY = (endY - startY) / currentScale;

    const threshold = 100 / currentScale; // Adjust threshold based on scale
    if (Math.abs(deltaX) > threshold || Math.abs(deltaY) > threshold) {
      dismissFlippedSquare(-deltaX, deltaY); // Invert X for dismissal
    } else {
      resetFlippedSquarePosition();
    }

    // Re-enable scrolling
    document.body.classList.remove('no-scroll');
    document.body.style.top = '';
    window.scrollTo(0, scrollY);
  }

  function dismissFlippedSquare(deltaX, deltaY) {
    const innerSquare = currentlyFlippedSquare.querySelector(
        '.project-square-inner');
    innerSquare.classList.add('dismissing');

    const finalX = deltaX * 2;
    const finalY = deltaY * 2;

    innerSquare.style.transform = `${originalTransform} translate(${finalX}px, ${finalY}px) scale(0.5) rotateY(0deg)`;

    setTimeout(() => {
      unflipSquare(currentlyFlippedSquare);
      resetProjectGrid();
      currentlyFlippedSquare = null;
    }, 300);
  }

  function resetFlippedSquarePosition() {
    const innerSquare = currentlyFlippedSquare.querySelector(
        '.project-square-inner');
    innerSquare.style.transition = 'transform 0.3s ease-out';
    innerSquare.style.transform = originalTransform;

    setTimeout(() => {
      innerSquare.style.transition = '';
    }, 300);
  }

  function resetProjectGrid() {
    projectsContainer.classList.remove('darkened');
    const allSquares = document.querySelectorAll('.project-square');
    allSquares.forEach(square => {
      const inner = square.querySelector('.project-square-inner');
      inner.classList.remove('darkened');
    });
  }

  // Add these event listeners
  document.addEventListener('mousedown', handleDragStart);
  document.addEventListener('mousemove', handleDrag);
  document.addEventListener('mouseup', handleDragEnd);
  document.addEventListener('touchstart', handleDragStart);
  document.addEventListener('touchmove', handleDrag);
  document.addEventListener('touchend', handleDragEnd);

  let currentlyFlippedSquare = null;

  projectsContainer.addEventListener('click', function (e) {
    const clickedSquare = e.target.closest('.project-square');
    const allSquares = document.querySelectorAll('.project-square');

    if (currentlyFlippedSquare) {
      // If clicking outside the flipped square or on another square
      if (!clickedSquare || clickedSquare !== currentlyFlippedSquare) {
        unflipSquare(currentlyFlippedSquare);
        projectsContainer.classList.remove('darkened');
        allSquares.forEach(square => {
          const inner = square.querySelector('.project-square-inner');
          inner.classList.remove('darkened');
        });
        currentlyFlippedSquare = null;
        if (!clickedSquare) {
          return;
        }
      }
    }

    if (clickedSquare && !e.target.closest('.close-button') && clickedSquare !== currentlyFlippedSquare) {
      flipSquare(clickedSquare);
      projectsContainer.classList.add('darkened');
      allSquares.forEach(square => {
        if (square !== clickedSquare) {
          const inner = square.querySelector('.project-square-inner');
          inner.classList.add('darkened');
        }
      });
      currentlyFlippedSquare = clickedSquare;
    }

    // Check if we should switch back to main view
    if (e.target === projectsContainer && !currentlyFlippedSquare) {
      switchToMain();
    }
  });

  window.addEventListener('resize', function () {
    // console.log("Resizing detected");
    if (currentlyFlippedSquare) {
      console.log("Flipped resizing");
      flipSquare(currentlyFlippedSquare);
    }

    resizeGrid();
  });
</script>
</body>

</html>